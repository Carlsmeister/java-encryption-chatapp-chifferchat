<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Circle?>
<BorderPane xmlns:fx="http://javafx.com/fxml/1"
            prefHeight="860"
            prefWidth="1280"
            minWidth="900"
            minHeight="600"
            styleClass="root-container"
            stylesheets="@styles.css"
            xmlns="http://javafx.com/javafx/21"
            fx:controller="se.mau.chifferchat.ui.ChatController">

    <!-- ============ MAIN LAYOUT ============ -->
    <left>
        <!-- Navigation Bar (Leftmost ~60px) + Chat List Panel (~280px) -->
        <HBox styleClass="left-section" minWidth="340" prefWidth="340">

            <!-- Navigation Bar (Icons) -->
            <VBox styleClass="navigation-bar" minWidth="60" prefWidth="60" alignment="TOP_CENTER" spacing="12">
                <padding>
                    <Insets top="12" bottom="12"/>
                </padding>

                <!-- App Logo/Icon -->
                <Button fx:id="homeButton" styleClass="nav-icon-button" onAction="#onHomeClick">
                    <graphic>
                        <Label text="ðŸ’¬" styleClass="nav-icon-label"/>
                    </graphic>
                    <tooltip>
                        <Tooltip text="Home"/>
                    </tooltip>
                </Button>

                <Separator styleClass="nav-separator"/>

                <!-- Friends Icon -->
                <Button fx:id="friendsButton" styleClass="nav-icon-button" onAction="#onFriendsClick">
                    <graphic>
                        <Label text="ðŸ‘¥" styleClass="nav-icon-label"/>
                    </graphic>
                    <tooltip>
                        <Tooltip text="Friends"/>
                    </tooltip>
                </Button>

                <!-- Groups Icon -->
                <Button fx:id="groupsButton" styleClass="nav-icon-button" onAction="#onGroupsClick">
                    <graphic>
                        <Label text="ðŸ”’" styleClass="nav-icon-label"/>
                    </graphic>
                    <tooltip>
                        <Tooltip text="Groups"/>
                    </tooltip>
                </Button>

                <Region VBox.vgrow="ALWAYS"/>

                <!-- Settings Icon (Bottom) -->
                <Button fx:id="settingsButton" styleClass="nav-icon-button" onAction="#onSettings">
                    <graphic>
                        <Label text="âš™ï¸" styleClass="nav-icon-label"/>
                    </graphic>
                    <tooltip>
                        <Tooltip text="Settings"/>
                    </tooltip>
                </Button>

                <!-- Theme Toggle -->
                <Button fx:id="themeToggleButton" styleClass="nav-icon-button" onAction="#onThemeToggle">
                    <graphic>
                        <Label fx:id="themeToggleIcon" text="ðŸŒ™" styleClass="nav-icon-label"/>
                    </graphic>
                    <tooltip>
                        <Tooltip text="Toggle Theme"/>
                    </tooltip>
                </Button>

                <!-- User Avatar -->
                <StackPane styleClass="user-avatar-container">
                    <Circle radius="20" styleClass="user-avatar-circle"/>
                    <Label fx:id="userAvatarLabel" text="U" styleClass="user-avatar-text"/>
                </StackPane>
            </VBox>

            <!-- Chat List Panel -->
            <VBox styleClass="chat-list-panel" minWidth="280" prefWidth="280" HBox.hgrow="ALWAYS">
                <padding>
                    <Insets top="12" left="12" right="12" bottom="8"/>
                </padding>

                <!-- Search Bar -->
                <HBox styleClass="search-bar-container">
                    <TextField fx:id="searchField"
                               promptText="Search..."
                               styleClass="search-field"
                               HBox.hgrow="ALWAYS"/>
                </HBox>

                <Region prefHeight="12"/>

                <!-- Tabs: All / Groups / Contacts -->
                <HBox styleClass="chat-tabs-container" spacing="8">
                    <Button fx:id="tabAllChats" text="All Chats" styleClass="chat-tab, chat-tab-active"
                            onAction="#onTabAllChats"/>
                    <Button fx:id="tabGroups" text="Groups" styleClass="chat-tab" onAction="#onTabGroups"/>
                    <Button fx:id="tabContacts" text="Contacts" styleClass="chat-tab" onAction="#onTabContacts"/>
                </HBox>

                <Region prefHeight="8"/>

                <!-- Chat/User List -->
                <ListView fx:id="chatListView"
                          styleClass="chat-list-view"
                          VBox.vgrow="ALWAYS">
                </ListView>

                <Region prefHeight="8"/>

                <!-- Create Group Button -->
                <Button fx:id="createGroupButton"
                        text="+ Create Group"
                        styleClass="create-group-button"
                        onAction="#onCreateGroup"
                        maxWidth="Infinity"/>
            </VBox>
        </HBox>
    </left>

    <!-- ============ CENTER CHAT WINDOW ============ -->
    <center>
        <BorderPane styleClass="chat-window">

            <!-- Top Bar -->
            <top>
                <HBox styleClass="chat-header" alignment="CENTER_LEFT" spacing="12">
                    <padding>
                        <Insets top="12" bottom="12" left="16" right="16"/>
                    </padding>

                    <!-- Chat Avatar/Icon -->
                    <StackPane styleClass="chat-avatar-container">
                        <Circle radius="18" styleClass="chat-avatar-circle"/>
                        <Label fx:id="chatAvatarLabel" text="?" styleClass="chat-avatar-text"/>
                    </StackPane>

                    <!-- Chat Info -->
                    <VBox spacing="2" HBox.hgrow="ALWAYS">
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <Label fx:id="chatTitleLabel" text="Select a chat" styleClass="chat-title"/>
                            <Label fx:id="encryptionStatusLabel" text="ðŸ”“" styleClass="encryption-status"/>
                        </HBox>
                        <Label fx:id="chatSubtitleLabel" text="Start a conversation" styleClass="chat-subtitle"/>
                    </VBox>

                    <Region HBox.hgrow="ALWAYS"/>

                    <!-- Action Buttons -->
                    <Label fx:id="clockLabel" text="12:00" styleClass="chat-clock"/>

                    <!-- Group Member Count (Clickable) -->
                    <Button fx:id="memberCountButton"
                            text="ðŸ‘¥ 0"
                            styleClass="icon-button, member-count-button"
                            onAction="#onToggleMemberDrawer"
                            visible="false"
                            managed="false"/>

                    <Button fx:id="callButton" styleClass="icon-button" onAction="#onCall">
                        <graphic>
                            <Label text="ðŸ“ž" styleClass="icon-label"/>
                        </graphic>
                    </Button>

                    <MenuButton styleClass="icon-button, menu-button">
                        <graphic>
                            <Label text="â‹¯" styleClass="icon-label"/>
                        </graphic>
                        <items>
                            <MenuItem text="Add to Group" onAction="#onAddToGroup"/>
                            <MenuItem text="Clear History" onAction="#onClearHistory"/>
                            <MenuItem text="Mute" onAction="#onMute"/>
                            <SeparatorMenuItem/>
                            <MenuItem text="Logout" onAction="#onLogout"/>
                        </items>
                    </MenuButton>
                </HBox>
            </top>

            <!-- Message Area -->
            <center>
                <StackPane styleClass="messages-container">
                    <ScrollPane fx:id="messagesScrollPane"
                                styleClass="messages-scroll-pane"
                                fitToWidth="true"
                                vbarPolicy="AS_NEEDED"
                                hbarPolicy="NEVER">
                        <VBox fx:id="messagesVBox"
                              styleClass="messages-vbox"
                              spacing="8">
                            <padding>
                                <Insets top="16" bottom="16" left="16" right="16"/>
                            </padding>
                        </VBox>
                    </ScrollPane>
                </StackPane>
            </center>

            <!-- Bottom Input Bar -->
            <bottom>
                <VBox styleClass="input-container">
                    <HBox styleClass="input-bar" spacing="8" alignment="CENTER_LEFT">
                        <padding>
                            <Insets top="12" bottom="12" left="16" right="16"/>
                        </padding>

                        <!-- Emoji Button -->
                        <Button styleClass="icon-button-small" onAction="#onEmojiPicker">
                            <graphic>
                                <Label text="ðŸ˜Š" styleClass="icon-label-small"/>
                            </graphic>
                        </Button>

                        <!-- Message Input -->
                        <TextField fx:id="messageField"
                                   promptText="Type a message..."
                                   styleClass="message-input"
                                   HBox.hgrow="ALWAYS"/>

                        <!-- Attachment Button -->
                        <Button styleClass="icon-button-small" onAction="#onAttachment">
                            <graphic>
                                <Label text="ðŸ“Ž" styleClass="icon-label-small"/>
                            </graphic>
                        </Button>

                        <!-- Voice Note Button -->
                        <Button styleClass="icon-button-small" onAction="#onVoiceNote">
                            <graphic>
                                <Label text="ðŸŽ¤" styleClass="icon-label-small"/>
                            </graphic>
                        </Button>

                        <!-- Send Button -->
                        <Button fx:id="sendButton"
                                styleClass="send-button"
                                onAction="#sendMessage">
                            <graphic>
                                <Label text="âž¡ï¸" styleClass="icon-label-small"/>
                            </graphic>
                        </Button>
                    </HBox>
                </VBox>
            </bottom>
        </BorderPane>
    </center>

    <!-- ============ RIGHT MEMBER DRAWER ============ -->
    <right>
        <VBox fx:id="memberDrawer"
              styleClass="member-drawer"
              minWidth="0"
              prefWidth="0"
              maxWidth="0"
              visible="false"
              managed="false">
            <padding>
                <Insets top="16" left="12" right="12" bottom="12"/>
            </padding>

            <!-- Drawer Header -->
            <HBox alignment="CENTER_LEFT" spacing="8">
                <Label text="Members" styleClass="drawer-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Button fx:id="closeMemberDrawerButton"
                        text="âœ•"
                        styleClass="icon-button-small"
                        onAction="#onToggleMemberDrawer"/>
            </HBox>

            <Region prefHeight="12"/>

            <!-- Add Member Button -->
            <Button fx:id="addMemberButton"
                    text="+ Add Member"
                    styleClass="add-member-button"
                    onAction="#onAddMember"
                    maxWidth="Infinity"/>

            <Region prefHeight="12"/>

            <!-- Member List -->
            <ListView fx:id="memberListView"
                      styleClass="member-list-view"
                      VBox.vgrow="ALWAYS">
            </ListView>
        </VBox>
    </right>

</BorderPane>

